<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#menu').load('menu.html');

            $('.btn-light').click(function (){
                alert(this.id);
            });

            let username = localStorage.getItem('username');
            let tasks;
            $.ajax({
                type: 'GET',
                url: `http://localhost:3000/tasks?username=${username}`,
                headers: {
                    'x-auth-token': localStorage.getItem("access-token")
                },
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    alert("succes");
                    tasks = data;

                    let tasksHtml = '<div id="tasks">';
                    tasks.forEach(task => {
                        tasksHtml += `
                            <div class="row card mt-3" style="height: 170px">
                                <div class="card-body">
                                    <h3>${task.name}</h3>
                                    <div class="progress mt-3" style="width: 790px">
                                    <div class="progress-bar " role="progressbar" style="width: ${task.percentage}%" aria-valuenow="75"
                                             aria-valuemin="0"
                                             aria-valuemax="100"></div>
                                    </div>
                                    <button id="${task.name}" type="button" class="btn btn-lg btn-light mt-4"
                                            data-toggle="modal" data-target="#exampleModalCenter">Matrixes</button>
                                    <div class="float-right mt-4">
                                        <button type="button" class="btn btn-lg btn-secondary">Pause</button>
                                        <button type="button" class="btn btn-lg btn-danger ml-3">Stop</button>
                                    </div>
                                </div>
                            </div>`
                    })
                    tasksHtml += '</div>'

                    $("#tasks").replaceWith(tasksHtml);
                },
                error: function (data) {
                    alert("error: " + data.responseText);
                }
            });
        });
    </script>
    <title>Progress</title>
</head>
<body>
<div id="menu" class="mb-5"></div>
<div class="container d-flex justify-content-center">
    <div style="width: 800px">
        <h1 class="d-flex justify-content-start mb-5">In Progress..</h1>
        <div id="tasks">
        </div>
    </div>
</div>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
